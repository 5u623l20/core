{% if helpers.exists('Elastic.Metricbeat') %}
######################## Metricbeat Configuration ###############################

#==========================  Modules configuration ==============================
metricbeat.config.modules:
  # Glob pattern for configuration loading
  path: ${path.config}/modules.d/*.yml

  # Set to true to enable config reloading
  reload.enabled: false

  # Period on which files under path should be checked for changes
  #reload.period: 10s

metricbeat.modules:
#------------------------------- System Module ---------------------------------
# @TODO: make metricsets selectable
- module: system
  metricsets:
    - cpu             # CPU usage
    - filesystem      # File system usage for each mountpoint
    - fsstat          # File system summary metrics
    - load            # CPU load averages
    - memory          # Memory usage
    - network         # Network IO
    - process         # Per process metrics
    - process_summary # Process summary
  enabled: true
  period: 30s
  processes: ['.*suricata.*'] # SEE has this as [Suricata.*]
#================================ General =======================================
name: "{{ system.hostname|trim }}"
tags: ["cfai-sensor"]

#================================ Logstash output =====================================
output.logstash:
  enabled: {% if Elastic.Metricbeat.general.output == "logstash" %}true{% else %}false{% endif %}

{% set logstash_hosts = Elastic.Metricbeat.outputs.logstash.hosts.split('\n') %}
  hosts: [{% for host in logstash_hosts %}"{{ host|trim }}"{{ "," if not loop.last }}{% endfor %}]
{% if Elastic.Metricbeat.outputs.logstash.ssl.enabled == "1" %}
  ssl.certificate_authorities: ["/usr/local/etc/metricbeat/metricbeat-ca.crt"]
  ssl.certificate: "/usr/local/etc/metricbeat/metricbeat.crt"
  ssl.key: "/usr/local/etc/metricbeat/metricbeat.key"
{% endif %}

{% endif %}

